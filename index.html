<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TARKIB LEGEND - SDIT Qurratu A'yun</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #ecfdf5; 
            touch-action: none; 
            overflow: hidden;
            user-select: none; 
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        .arabic-text {
            font-family: 'Amiri', serif;
            line-height: 1.8;
        }
        button {
            touch-action: none;
            -webkit-tap-highlight-color: transparent;
        }
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .pop-in { animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .pulse-red { animation: pulseRed 1s infinite; }
        @keyframes pulseRed {
            0% { color: #ef4444; }
            50% { color: #7f1d1d; }
            100% { color: #ef4444; }
        }
        .bg-pattern {
            background-image: radial-gradient(#10b981 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.1;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body oncontextmenu="return false;">
    <div id="root"></div>

    <script type="text/babel">
        // --- SOUND ENGINE ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        const playTone = (freq, type, duration, delay = 0) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.value = freq;
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(audioCtx.currentTime + delay);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime + delay);
            gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + delay + duration);
            osc.stop(audioCtx.currentTime + delay + duration);
        };

        const playCorrectSound = () => { playTone(600, 'sine', 0.1); playTone(800, 'sine', 0.2, 0.1); };
        const playWrongSound = () => { playTone(150, 'sawtooth', 0.3); };
        const playLevelCompleteSound = () => { playTone(400, 'triangle', 0.1); playTone(500, 'triangle', 0.1, 0.1); playTone(600, 'triangle', 0.1, 0.2); playTone(800, 'triangle', 0.4, 0.3); };
        const playGrandFanfare = () => { [523, 659, 783, 1046, 783, 1046].forEach((freq, i) => { playTone(freq, 'square', 0.2, i * 0.15); }); };

        // --- VISUAL EFFECTS ---
        const fireConfetti = (intensity = 1) => {
            if (typeof confetti === 'undefined') return;
            if (intensity === 1) {
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            } else {
                var duration = 3000; var end = Date.now() + duration;
                (function frame() {
                    confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 } });
                    confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 } });
                    if (Date.now() < end) requestAnimationFrame(frame);
                }());
            }
        };

        // --- DATA SOAL KOMPREHENSIF ---
        const gameDataDatabase = [
            // === LEVEL 1A: FRASA JAR MAJRUR & ZHARAF ===
            { level: 1.1, category: "L1A: Jar Majrur (Min)", indonesian: "Dari rumah", correctWords: ["ŸÖŸêŸÜŸé", "ÿßŸÑŸíÿ®ŸéŸäŸíÿ™Ÿê"], distractors: ["ÿ•ŸêŸÑŸéŸâ", "ÿ®ŸéŸäŸíÿ™Ÿå"] },
            { level: 1.1, category: "L1A: Jar Majrur (Ila)", indonesian: "Ke sekolah", correctWords: ["ÿ•ŸêŸÑŸéŸâ", "ÿßŸÑŸíŸÖŸéÿØŸíÿ±Ÿéÿ≥Ÿéÿ©Ÿê"], distractors: ["ŸÖŸêŸÜŸé", "ŸÖŸéÿØŸíÿ±Ÿéÿ≥Ÿéÿ©Ÿå"] },
            { level: 1.1, category: "L1A: Jar Majrur (Fi)", indonesian: "Di dalam kelas", correctWords: ["ŸÅŸêŸä", "ÿßŸÑŸíŸÅŸéÿµŸíŸÑŸê"], distractors: ["ÿπŸéŸÑŸéŸâ", "ŸÅŸéÿµŸíŸÑŸå"] },
            { level: 1.1, category: "L1A: Jar Majrur ('Ala)", indonesian: "Di atas meja", correctWords: ["ÿπŸéŸÑŸéŸâ", "ÿßŸÑŸíŸÖŸéŸÉŸíÿ™Ÿéÿ®Ÿê"], distractors: ["ŸÅŸêŸä", "ŸÖŸéŸÉŸíÿ™Ÿéÿ®Ÿå"] },
            { level: 1.1, category: "L1A: Jar Majrur ('An)", indonesian: "Tentang berita itu", correctWords: ["ÿπŸéŸÜŸê", "ÿßŸÑŸÜŸëŸéÿ®Ÿéÿ•Ÿê"], distractors: ["ŸÅŸêŸä", "ŸÜŸéÿ®Ÿéÿ£Ÿç"] },
            { level: 1.1, category: "L1A: Jar Majrur (Fi)", indonesian: "Di dalam tas", correctWords: ["ŸÅŸêŸä", "ÿßŸÑŸíÿ≠ŸéŸÇŸêŸäÿ®Ÿéÿ©Ÿê"], distractors: ["ÿπŸéŸÑŸéŸâ", "ÿ≠ŸéŸÇŸêŸäÿ®Ÿéÿ©Ÿå"] },
            { level: 1.1, category: "L1A: Jar Majrur ('Ala)", indonesian: "Di atas kursi", correctWords: ["ÿπŸéŸÑŸéŸâ", "ÿßŸÑŸíŸÉŸèÿ±Ÿíÿ≥ŸêŸäŸëŸê"], distractors: ["ÿ™Ÿéÿ≠Ÿíÿ™Ÿé", "ŸÉŸèÿ±Ÿíÿ≥ŸêŸäŸëŸå"] },
            { level: 1.1, category: "L1A: Jar Majrur (Fi)", indonesian: "Di dalam lemari", correctWords: ["ŸÅŸêŸä", "ÿßŸÑŸíÿÆŸêÿ≤ŸéÿßŸÜŸéÿ©Ÿê"], distractors: ["ÿπŸéŸÑŸéŸâ", "ÿÆŸêÿ≤ŸéÿßŸÜŸéÿ©Ÿå"] },
            { level: 1.1, category: "L1A: Jar Majrur (Ila)", indonesian: "Ke masjid", correctWords: ["ÿ•ŸêŸÑŸéŸâ", "ÿßŸÑŸíŸÖŸéÿ≥Ÿíÿ¨ŸêÿØŸê"], distractors: ["ŸÖŸêŸÜŸé", "ŸÖŸéÿ≥Ÿíÿ¨ŸêÿØŸå"] },
            { level: 1.1, category: "L1A: Jar Majrur ('Ala)", indonesian: "Di atas ranjang", correctWords: ["ÿπŸéŸÑŸéŸâ", "ÿßŸÑÿ≥ŸëŸéÿ±ŸêŸäÿ±Ÿê"], distractors: ["ŸÅŸêŸä", "ÿ≥Ÿéÿ±ŸêŸäÿ±Ÿå"] },
            { level: 1.1, category: "L1A: Jar Majrur (Bi)", indonesian: "Dengan pena", correctWords: ["ÿ®ŸêÿßŸÑŸíŸÇŸéŸÑŸéŸÖŸê"], distractors: ["ÿ®Ÿê", "ŸÇŸéŸÑŸéŸÖŸå"] },
            { level: 1.1, category: "L1A: Jar Majrur (Li)", indonesian: "Milik Allah", correctWords: ["ŸÑŸêŸÑŸëŸéŸáŸê"], distractors: ["ŸÑŸê", "ÿßŸÑŸÑŸáŸê"] },
            { level: 1.1, category: "L1A: Jar Majrur (Ka)", indonesian: "Seperti bulan", correctWords: ["ŸÉŸéÿßŸÑŸíŸÇŸéŸÖŸéÿ±Ÿê"], distractors: ["ŸÉŸé", "ŸÇŸéŸÖŸéÿ±Ÿå"] },
            { level: 1.1, category: "L1A: Jar Majrur (Li)", indonesian: "Untuk guru (lk)", correctWords: ["ŸÑŸêŸÑŸíŸÖŸèÿØŸéÿ±ŸëŸêÿ≥Ÿê"], distractors: ["ŸÑŸê", "ŸÖŸèÿØŸéÿ±ŸëŸêÿ≥Ÿå"] },
            { level: 1.1, category: "L1A: Zharaf", indonesian: "Di depan sekolah", correctWords: ["ÿ£ŸéŸÖŸéÿßŸÖŸé", "ÿßŸÑŸíŸÖŸéÿØŸíÿ±Ÿéÿ≥Ÿéÿ©Ÿê"], distractors: ["ŸàŸéÿ±Ÿéÿßÿ°Ÿé", "ŸÖŸéÿØŸíÿ±Ÿéÿ≥Ÿéÿ©Ÿå"] },
            { level: 1.1, category: "L1A: Zharaf", indonesian: "Di belakang dapur", correctWords: ["ŸàŸéÿ±Ÿéÿßÿ°Ÿé", "ÿßŸÑŸíŸÖŸéÿ∑Ÿíÿ®ŸéÿÆŸê"], distractors: ["ÿ£ŸéŸÖŸéÿßŸÖŸé", "ŸÖŸéÿ∑Ÿíÿ®ŸéÿÆŸå"] },
            { level: 1.1, category: "L1A: Zharaf", indonesian: "Di samping toko", correctWords: ["ÿ¨ŸéÿßŸÜŸêÿ®Ÿé", "ÿßŸÑÿØŸëŸèŸÉŸëŸéÿßŸÜŸê"], distractors: ["ÿ£ŸéŸÖŸéÿßŸÖŸé", "ÿØŸèŸÉŸëŸéÿßŸÜŸå"] },
            { level: 1.1, category: "L1A: Zharaf", indonesian: "Di bawah meja", correctWords: ["ÿ™Ÿéÿ≠Ÿíÿ™Ÿé", "ÿßŸÑŸíŸÖŸéŸÉŸíÿ™Ÿéÿ®Ÿê"], distractors: ["ŸÅŸéŸàŸíŸÇŸé", "ŸÖŸéŸÉŸíÿ™Ÿéÿ®Ÿå"] },

            // === LEVEL 1B: FRASA IDHAFAH ===
            { level: 1.2, category: "L1B: Idhafah", indonesian: "Pintu masjid", correctWords: ["ÿ®Ÿéÿßÿ®Ÿè", "ÿßŸÑŸíŸÖŸéÿ≥Ÿíÿ¨ŸêÿØŸê"], distractors: ["ÿßŸÑŸíÿ®Ÿéÿßÿ®Ÿè", "ŸÖŸéÿ≥Ÿíÿ¨ŸêÿØŸãÿß"] },
            { level: 1.2, category: "L1B: Idhafah", indonesian: "Kitab Allah", correctWords: ["ŸÉŸêÿ™Ÿéÿßÿ®Ÿè", "ÿßŸÑŸÑŸáŸê"], distractors: ["ŸÉŸêÿ™Ÿéÿßÿ®Ÿå", "ÿßŸÑŸÑŸáŸé"] },
            { level: 1.2, category: "L1B: Idhafah", indonesian: "Utusan Allah", correctWords: ["ÿ±Ÿéÿ≥ŸèŸàŸÑŸè", "ÿßŸÑŸÑŸáŸê"], distractors: ["ÿ±Ÿéÿ≥ŸèŸàŸÑŸå", "ÿßŸÑŸÑŸáŸé"] },
            { level: 1.2, category: "L1B: Idhafah", indonesian: "Guru (lk) sekolah", correctWords: ["ŸÖŸèÿØŸéÿ±ŸëŸêÿ≥Ÿè", "ÿßŸÑŸíŸÖŸéÿØŸíÿ±Ÿéÿ≥Ÿéÿ©Ÿê"], distractors: ["ŸÖŸèÿØŸéÿ±ŸëŸêÿ≥Ÿå", "ŸÖŸéÿØŸíÿ±Ÿéÿ≥Ÿéÿ©Ÿã"] },
            { level: 1.2, category: "L1B: Idhafah", indonesian: "Kepala sekolah (pr)", correctWords: ["ŸÖŸèÿØŸêŸäÿ±Ÿéÿ©Ÿè", "ÿßŸÑŸíŸÖŸéÿØŸíÿ±Ÿéÿ≥Ÿéÿ©Ÿê"], distractors: ["ŸÖŸèÿØŸêŸäÿ±Ÿéÿ©Ÿå", "ŸÖŸéÿØŸíÿ±Ÿéÿ≥Ÿéÿ©Ÿå"] },
            { level: 1.2, category: "L1B: Idhafah", indonesian: "Kunci rumah", correctWords: ["ŸÖŸêŸÅŸíÿ™Ÿéÿßÿ≠Ÿè", "ÿßŸÑŸíÿ®ŸéŸäŸíÿ™Ÿê"], distractors: ["ŸÖŸêŸÅŸíÿ™Ÿéÿßÿ≠Ÿå", "ÿ®ŸéŸäŸíÿ™Ÿå"] },
            { level: 1.2, category: "L1B: Idhafah", indonesian: "Rumah Allah (Ka'bah)", correctWords: ["ÿ®ŸéŸäŸíÿ™Ÿè", "ÿßŸÑŸÑŸáŸê"], distractors: ["ÿ®ŸéŸäŸíÿ™Ÿå", "ÿßŸÑŸÑŸáŸé"] },
            { level: 1.2, category: "L1B: Idhafah", indonesian: "Agama Islam", correctWords: ["ÿØŸêŸäŸÜŸè", "ÿßŸÑŸíÿ•Ÿêÿ≥ŸíŸÑŸéÿßŸÖŸê"], distractors: ["ÿØŸêŸäŸÜŸå", "ÿ•Ÿêÿ≥ŸíŸÑŸéÿßŸÖŸãÿß"] },
            { level: 1.2, category: "L1B: Idhafah", indonesian: "Cahaya Iman", correctWords: ["ŸÜŸèŸàÿ±Ÿè", "ÿßŸÑŸíÿ•ŸêŸäŸÖŸéÿßŸÜŸê"], distractors: ["ŸÜŸèŸàÿ±Ÿå", "ÿ•ŸêŸäŸÖŸéÿßŸÜŸãÿß"] },
            { level: 1.2, category: "L1B: Idhafah", indonesian: "Siksa Kubur", correctWords: ["ÿπŸéÿ∞Ÿéÿßÿ®Ÿè", "ÿßŸÑŸíŸÇŸéÿ®Ÿíÿ±Ÿê"], distractors: ["ÿπŸéÿ∞Ÿéÿßÿ®Ÿå", "ŸÇŸéÿ®Ÿíÿ±Ÿãÿß"] },
            { level: 1.2, category: "L1B: Idhafah", indonesian: "Penduduk Surga", correctWords: ["ÿ£ŸéŸáŸíŸÑŸè", "ÿßŸÑŸíÿ¨ŸéŸÜŸëŸéÿ©Ÿê"], distractors: ["ÿ£ŸéŸáŸíŸÑŸå", "ÿ¨ŸéŸÜŸëŸéÿ©Ÿå"] },
            { level: 1.2, category: "L1B: Idhafah", indonesian: "Hari Kiamat", correctWords: ["ŸäŸéŸàŸíŸÖŸè", "ÿßŸÑŸíŸÇŸêŸäŸéÿßŸÖŸéÿ©Ÿê"], distractors: ["ŸäŸéŸàŸíŸÖŸå", "ŸÇŸêŸäŸéÿßŸÖŸéÿ©Ÿå"] },

            // === LEVEL 1C: FRASA NA'AT MAN'UT ===
            { level: 1.3, category: "L1C: Sifat (Nakirah)", indonesian: "Sebuah tas baru", correctWords: ["ÿ≠ŸéŸÇŸêŸäÿ®Ÿéÿ©Ÿå", "ÿ¨ŸéÿØŸêŸäÿØŸéÿ©Ÿå"], distractors: ["ÿßŸÑŸíÿ≠ŸéŸÇŸêŸäÿ®Ÿéÿ©Ÿè", "ÿßŸÑŸíÿ¨ŸéÿØŸêŸäÿØŸéÿ©Ÿè"] },
            { level: 1.3, category: "L1C: Sifat (Nakirah)", indonesian: "Seorang murid yang rajin", correctWords: ["ÿ∑ŸéÿßŸÑŸêÿ®Ÿå", "ŸÖŸèÿ¨Ÿíÿ™ŸéŸáŸêÿØŸå"], distractors: ["ÿßŸÑÿ∑ŸëŸéÿßŸÑŸêÿ®Ÿè", "ÿßŸÑŸíŸÖŸèÿ¨Ÿíÿ™ŸéŸáŸêÿØŸè"] },
            { level: 1.3, category: "L1C: Sifat (Nakirah)", indonesian: "Sebuah pulpen lama", correctWords: ["ŸÇŸéŸÑŸéŸÖŸå", "ŸÇŸéÿØŸêŸäŸÖŸå"], distractors: ["ÿßŸÑŸíŸÇŸéŸÑŸéŸÖŸè", "ÿ¨ŸéÿØŸêŸäÿØŸå"] },
            { level: 1.3, category: "L1C: Sifat (Nakirah)", indonesian: "Seorang guru (pr) yang pandai", correctWords: ["ŸÖŸèÿØŸéÿ±ŸëŸêÿ≥Ÿéÿ©Ÿå", "ŸÖŸéÿßŸáŸêÿ±Ÿéÿ©Ÿå"], distractors: ["ŸÖŸèÿØŸéÿ±ŸëŸêÿ≥Ÿå", "ŸÖŸéÿßŸáŸêÿ±Ÿå"] },
            { level: 1.3, category: "L1C: Sifat (Nakirah)", indonesian: "Kemeja putih", correctWords: ["ŸÇŸéŸÖŸêŸäÿµŸå", "ÿ£Ÿéÿ®ŸíŸäŸéÿ∂Ÿè"], distractors: ["ŸÇŸéŸÖŸêŸäÿµŸãÿß", "ÿ£Ÿéÿ≥ŸíŸàŸéÿØŸè"] },
            { level: 1.3, category: "L1C: Sifat (Ma'rifah)", indonesian: "Peci yang hitam itu", correctWords: ["ÿßŸÑŸíŸÇŸéŸÑŸéŸÜŸíÿ≥ŸèŸàŸéÿ©Ÿè", "ÿßŸÑÿ≥ŸëŸéŸàŸíÿØŸéÿßÿ°Ÿè"], distractors: ["ŸÇŸéŸÑŸéŸÜŸíÿ≥ŸèŸàŸéÿ©Ÿå", "ÿ≥ŸéŸàŸíÿØŸéÿßÿ°Ÿè"] },
            { level: 1.3, category: "L1C: Sifat (Ma'rifah)", indonesian: "Kemeja yang bersih itu", correctWords: ["ÿßŸÑŸíŸÇŸéŸÖŸêŸäÿµŸè", "ÿßŸÑŸÜŸëŸéÿ∏ŸêŸäŸÅŸè"], distractors: ["ŸÇŸéŸÖŸêŸäÿµŸå", "ŸÜŸéÿ∏ŸêŸäŸÅŸå"] },
            { level: 1.3, category: "L1C: Sifat (Ma'rifah)", indonesian: "Kelas yang luas itu", correctWords: ["ÿßŸÑŸíŸÅŸéÿµŸíŸÑŸè", "ÿßŸÑŸíŸàŸéÿßÿ≥ŸêÿπŸè"], distractors: ["ŸÅŸéÿµŸíŸÑŸå", "ŸàŸéÿßÿ≥ŸêÿπŸå"] },
            { level: 1.3, category: "L1C: Sifat (Ma'rifah)", indonesian: "Sekolah yang besar itu", correctWords: ["ÿßŸÑŸíŸÖŸéÿØŸíÿ±Ÿéÿ≥Ÿéÿ©Ÿè", "ÿßŸÑŸíŸÉŸéÿ®ŸêŸäÿ±Ÿéÿ©Ÿè"], distractors: ["ŸÖŸéÿØŸíÿ±Ÿéÿ≥Ÿéÿ©Ÿå", "ŸÉŸéÿ®ŸêŸäÿ±Ÿéÿ©Ÿå"] },
            { level: 1.3, category: "L1C: Sifat (Ma'rifah)", indonesian: "Jalan yang lurus itu", correctWords: ["ÿßŸÑÿµŸëŸêÿ±Ÿéÿßÿ∑Ÿè", "ÿßŸÑŸíŸÖŸèÿ≥Ÿíÿ™ŸéŸÇŸêŸäŸÖŸè"], distractors: ["ÿµŸêÿ±Ÿéÿßÿ∑Ÿå", "ŸÖŸèÿ≥Ÿíÿ™ŸéŸÇŸêŸäŸÖŸå"] },

            // === LEVEL 2: JUMLAH ISMIYAH ===
            { level: 2, category: "L2: Khobar Mufrad", indonesian: "Dokter itu mahir", correctWords: ["ÿßŸÑÿ∑ŸëŸéÿ®ŸêŸäÿ®Ÿè", "ŸÖŸéÿßŸáŸêÿ±Ÿå"], distractors: ["ŸÖŸéÿßŸáŸêÿ±Ÿéÿ©Ÿå", "ÿ∑Ÿéÿ®ŸêŸäÿ®Ÿå"] },
            { level: 2, category: "L2: Khobar Mufrad", indonesian: "Gajah itu besar", correctWords: ["ÿßŸÑŸíŸÅŸêŸäŸÑŸè", "ŸÉŸéÿ®ŸêŸäÿ±Ÿå"], distractors: ["ÿµŸéÿ∫ŸêŸäÿ±Ÿå", "ŸÜŸéŸÖŸíŸÑŸå"] },
            { level: 2, category: "L2: Khobar Mufrad", indonesian: "Apel itu manis", correctWords: ["ÿßŸÑÿ™ŸèŸëŸÅŸéŸëÿßÿ≠Ÿè", "ÿ≠ŸèŸÑŸíŸàŸå"], distractors: ["ŸÖŸèÿ±ŸåŸë", "ÿ≠ŸéÿßŸÖŸêÿ∂Ÿå"] },
            { level: 2, category: "L2: Khobar Mufrad", indonesian: "Rumah itu luas", correctWords: ["ÿßŸÑŸíÿ®ŸéŸäŸíÿ™Ÿè", "ŸàŸéÿßÿ≥ŸêÿπŸå"], distractors: ["ÿ∂ŸéŸäŸëŸêŸÇŸå", "ÿ®ŸéŸäŸíÿ™Ÿå"] },
            { level: 2, category: "L2: Khobar Mufrad", indonesian: "Lantai itu bersih", correctWords: ["ÿßŸÑŸíÿ®ŸêŸÑŸéÿßÿ∑Ÿè", "ŸÜŸéÿ∏ŸêŸäŸÅŸå"], distractors: ["ŸàŸéÿ≥ŸêÿÆŸå", "ÿ®ŸêŸÑŸéÿßÿ∑Ÿå"] },
            { level: 2, category: "L2: Khobar Mufrad", indonesian: "Kopi itu pahit", correctWords: ["ÿßŸÑŸíŸÇŸéŸáŸíŸàŸéÿ©Ÿè", "ŸÖŸèÿ±ŸëŸéÿ©Ÿå"], distractors: ["ÿ≠ŸèŸÑŸíŸàŸéÿ©Ÿå", "ŸÇŸéŸáŸíŸàŸéÿ©Ÿå"] },
            { level: 2, category: "L2: Khobar Mufrad", indonesian: "Pedagang itu kaya", correctWords: ["ÿßŸÑÿ™ŸëŸéÿßÿ¨Ÿêÿ±Ÿè", "ÿ∫ŸéŸÜŸêŸäŸëŸå"], distractors: ["ŸÅŸéŸÇŸêŸäÿ±Ÿå", "ÿ™Ÿéÿßÿ¨Ÿêÿ±Ÿå"] },
            { level: 2, category: "L2: Khobar Mufrad", indonesian: "Singa itu kuat", correctWords: ["ÿßŸÑŸíÿ£Ÿéÿ≥ŸéÿØŸè", "ŸÇŸéŸàŸêŸäŸëŸå"], distractors: ["ÿ∂ŸéÿπŸêŸäŸÅŸå", "ÿ£Ÿéÿ≥ŸéÿØŸå"] },
            { level: 2, category: "L2: Khobar Syibhul Jumlah", indonesian: "Murid di dalam perpustakaan", correctWords: ["ÿßŸÑÿ∑ŸëŸéÿßŸÑŸêÿ®Ÿè", "ŸÅŸêŸä", "ÿßŸÑŸíŸÖŸéŸÉŸíÿ™Ÿéÿ®Ÿéÿ©Ÿê"], distractors: ["ÿπŸéŸÑŸéŸâ", "ÿ∑ŸéÿßŸÑŸêÿ®Ÿå"] },
            { level: 2, category: "L2: Khobar Syibhul Jumlah", indonesian: "Mobil di depan rumah", correctWords: ["ÿßŸÑÿ≥ŸëŸéŸäŸëŸéÿßÿ±Ÿéÿ©Ÿè", "ÿ£ŸéŸÖŸéÿßŸÖŸé", "ÿßŸÑŸíÿ®ŸéŸäŸíÿ™Ÿê"], distractors: ["ŸàŸéÿ±Ÿéÿßÿ°Ÿé", "ÿ®ŸéŸäŸíÿ™Ÿå"] },
            { level: 2, category: "L2: Khobar Syibhul Jumlah", indonesian: "Jam di atas dinding", correctWords: ["ÿßŸÑÿ≥ŸëŸéÿßÿπŸéÿ©Ÿè", "ÿπŸéŸÑŸéŸâ", "ÿßŸÑŸíÿ¨ŸêÿØŸéÿßÿ±Ÿê"], distractors: ["ŸÅŸêŸä", "ÿ≥ŸéÿßÿπŸéÿ©Ÿå"] },
            { level: 2, category: "L2: Khobar Syibhul Jumlah", indonesian: "Pakaian di dalam lemari", correctWords: ["ÿßŸÑŸíŸÖŸéŸÑŸéÿßÿ®Ÿêÿ≥Ÿè", "ŸÅŸêŸä", "ÿßŸÑŸíÿÆŸêÿ≤ŸéÿßŸÜŸéÿ©Ÿê"], distractors: ["ÿπŸéŸÑŸéŸâ", "ÿÆŸêÿ≤ŸéÿßŸÜŸéÿ©Ÿå"] },
            { level: 2, category: "L2: Khobar Syibhul Jumlah", indonesian: "Ikan di dalam air", correctWords: ["ÿßŸÑÿ≥ŸëŸéŸÖŸéŸÉŸè", "ŸÅŸêŸä", "ÿßŸÑŸíŸÖŸéÿßÿ°Ÿê"], distractors: ["ÿπŸéŸÑŸéŸâ", "ŸÖŸéÿßÿ°Ÿå"] },
            { level: 2, category: "L2: Khobar Syibhul Jumlah", indonesian: "Piring di atas meja", correctWords: ["ÿßŸÑÿµŸëŸéÿ≠ŸíŸÜŸè", "ÿπŸéŸÑŸéŸâ", "ÿßŸÑŸíŸÖŸéŸÉŸíÿ™Ÿéÿ®Ÿê"], distractors: ["ŸÅŸêŸä", "ÿµŸéÿ≠ŸíŸÜŸå"] },
            { level: 2, category: "L2: Syibhul Jumlah", indonesian: "Hadits dari Abu Hurairah", correctWords: ["ÿßŸÑŸíÿ≠ŸéÿØŸêŸäÿ´Ÿè", "ÿπŸéŸÜŸí", "ÿ£Ÿéÿ®ŸêŸä", "ŸáŸèÿ±ŸéŸäŸíÿ±Ÿéÿ©Ÿé"], distractors: ["ŸÅŸêŸä", "ÿ£Ÿéÿ®Ÿéÿß"] },
            { level: 2, category: "L2: Kalimat Hikmah", indonesian: "Sholat itu cahaya", correctWords: ["ÿßŸÑÿµŸëŸéŸÑŸéÿßÿ©Ÿè", "ŸÜŸèŸàÿ±Ÿå"], distractors: ["ÿµŸéŸÑŸéÿßÿ©Ÿå", "ŸÜŸèŸàÿ±Ÿãÿß"] },
            { level: 2, category: "L2: Kalimat Hikmah", indonesian: "Kebersihan itu sebagian dari iman", correctWords: ["ÿßŸÑŸÜŸëŸéÿ∏ŸéÿßŸÅŸéÿ©Ÿè", "ŸÖŸêŸÜŸé", "ÿßŸÑŸíÿ•ŸêŸäŸÖŸéÿßŸÜŸê"], distractors: ["ŸÜŸéÿ∏ŸéÿßŸÅŸéÿ©Ÿå", "ÿ•ŸêŸäŸÖŸéÿßŸÜŸå"] },
            { level: 2, category: "L2: Kalimat Hikmah", indonesian: "Segala puji bagi Allah", correctWords: ["ÿßŸÑŸíÿ≠ŸéŸÖŸíÿØŸè", "ŸÑŸêŸÑŸëŸéŸáŸê"], distractors: ["ŸÑŸê", "ÿßŸÑŸÑŸáŸê"] },
            { level: 2, category: "L2: Kalimat Hikmah", indonesian: "Mukmin itu seperti bangunan", correctWords: ["ÿßŸÑŸíŸÖŸèÿ§ŸíŸÖŸêŸÜŸè", "ŸÉŸéÿßŸÑŸíÿ®ŸèŸÜŸíŸäŸéÿßŸÜŸê"], distractors: ["ŸÉŸé", "ÿ®ŸèŸÜŸíŸäŸéÿßŸÜŸå"] },

            // === LEVEL 3: JUMLAH FI'LIYAH ===
            { level: 3, category: "L3: Fi'il Madhi", indonesian: "Zaid telah pergi", correctWords: ["ÿ∞ŸéŸáŸéÿ®Ÿé", "ÿ≤ŸéŸäŸíÿØŸå"], distractors: ["ŸäŸéÿ∞ŸíŸáŸéÿ®Ÿè", "ÿ≤ŸéŸäŸíÿØŸãÿß"] }, 
            { level: 3, category: "L3: Fi'il Madhi", indonesian: "Anak (lk) itu telah tidur", correctWords: ["ŸÜŸéÿßŸÖŸé", "ÿßŸÑŸíŸàŸéŸÑŸéÿØŸè"], distractors: ["ŸäŸéŸÜŸéÿßŸÖŸè", "ŸàŸéŸÑŸéÿØŸãÿß"] }, 
            { level: 3, category: "L3: Fi'il Madhi", indonesian: "Ahmad telah minum", correctWords: ["ÿ¥Ÿéÿ±Ÿêÿ®Ÿé", "ÿ£Ÿéÿ≠ŸíŸÖŸéÿØŸè"], distractors: ["ŸäŸéÿ¥Ÿíÿ±Ÿéÿ®Ÿè", "ÿ£Ÿéÿ≠ŸíŸÖŸéÿØŸé"] }, 
            { level: 3, category: "L3: Fi'il Madhi", indonesian: "Hamid telah masuk", correctWords: ["ÿØŸéÿÆŸéŸÑŸé", "ÿ≠ŸéÿßŸÖŸêÿØŸå"], distractors: ["ŸäŸéÿØŸíÿÆŸèŸÑŸè", "ÿÆŸéÿ±Ÿéÿ¨Ÿé"] },
            { level: 3, category: "L3: Fi'il Madhi", indonesian: "Tamu itu telah datang", correctWords: ["ÿ¨Ÿéÿßÿ°Ÿé", "ÿßŸÑÿ∂ŸëŸéŸäŸíŸÅŸè"], distractors: ["ŸäŸéÿ¨ŸêŸäÿ°Ÿè", "ÿ∂ŸéŸäŸíŸÅŸãÿß"] },
            { level: 3, category: "L3: Fi'il Madhi", indonesian: "Anak (lk) itu telah duduk", correctWords: ["ÿ¨ŸéŸÑŸéÿ≥Ÿé", "ÿßŸÑŸíŸàŸéŸÑŸéÿØŸè"], distractors: ["ŸäŸéÿ¨ŸíŸÑŸêÿ≥Ÿè", "ŸàŸéŸÑŸéÿØŸå"] },
            { level: 3, category: "L3: Fi'il Madhi", indonesian: "Orang kafir itu telah ingkar", correctWords: ["ŸÉŸéŸÅŸéÿ±Ÿé", "ÿßŸÑŸíŸÉŸéÿßŸÅŸêÿ±Ÿè"], distractors: ["ŸäŸéŸÉŸíŸÅŸèÿ±Ÿè", "ŸÉŸéÿßŸÅŸêÿ±Ÿãÿß"] },
            { level: 3, category: "L3: Fi'il Madhi", indonesian: "Bayi itu telah tertawa", correctWords: ["ÿ∂Ÿéÿ≠ŸêŸÉŸé", "ÿßŸÑÿ∑ŸëŸêŸÅŸíŸÑŸè"], distractors: ["ŸäŸéÿ∂Ÿíÿ≠ŸéŸÉŸè", "ÿ∑ŸêŸÅŸíŸÑŸãÿß"] },
            { level: 3, category: "L3: Fi'il Madhi", indonesian: "Bapak telah sakit", correctWords: ["ŸÖŸéÿ±Ÿêÿ∂Ÿé", "ÿßŸÑŸíÿ£Ÿéÿ®Ÿè"], distractors: ["ŸäŸéŸÖŸíÿ±Ÿéÿ∂Ÿè", "ÿ£Ÿéÿ®Ÿå"] },
            { level: 3, category: "L3: Fi'il Madhi", indonesian: "Anak-anak telah bermain", correctWords: ["ŸÑŸéÿπŸêÿ®Ÿé", "ÿßŸÑŸíÿ£ŸéŸàŸíŸÑŸéÿßÿØŸè"], distractors: ["ŸäŸéŸÑŸíÿπŸéÿ®Ÿè", "ÿ£ŸéŸàŸíŸÑŸéÿßÿØŸãÿß"] },
            { level: 3, category: "L3: Fi'il Madhi", indonesian: "Zaid telah tinggal (menetap)", correctWords: ["ÿ≥ŸéŸÉŸéŸÜŸé", "ÿ≤ŸéŸäŸíÿØŸå"], distractors: ["ŸäŸéÿ≥ŸíŸÉŸèŸÜŸè", "ÿ≤ŸéŸäŸíÿØŸãÿß"] },
            { level: 3, category: "L3: Fi'il Madhi", indonesian: "Ibu telah memberi izin", correctWords: ["ÿ£Ÿéÿ∞ŸêŸÜŸéÿ™Ÿí", "ÿßŸÑŸíÿ£ŸèŸÖŸëŸè"], distractors: ["ÿ™Ÿéÿ£Ÿíÿ∞ŸéŸÜŸè", "ÿ£ŸèŸÖŸëŸãÿß"] },
            { level: 3, category: "L3: Fi'il Madhi", indonesian: "Guru (lk) telah berdiri", correctWords: ["ŸÇŸéÿßŸÖŸé", "ÿßŸÑŸíŸÖŸèÿØŸéÿ±ŸëŸêÿ≥Ÿè"], distractors: ["ŸäŸéŸÇŸèŸàŸÖŸè", "ŸÖŸèÿØŸéÿ±ŸëŸêÿ≥Ÿãÿß"] },
            { level: 3, category: "L3: Fi'il Madhi", indonesian: "Siswa telah lulus (berhasil)", correctWords: ["ŸÜŸéÿ¨Ÿéÿ≠Ÿé", "ÿßŸÑÿ∑ŸëŸéÿßŸÑŸêÿ®Ÿè"], distractors: ["ŸäŸéŸÜŸíÿ¨Ÿéÿ≠Ÿè", "ÿ∑ŸéÿßŸÑŸêÿ®Ÿãÿß"] },
            { level: 3, category: "L3: Fi'il Madhi", indonesian: "Orang muslim telah ruku'", correctWords: ["ÿ±ŸéŸÉŸéÿπŸé", "ÿßŸÑŸíŸÖŸèÿ≥ŸíŸÑŸêŸÖŸè"], distractors: ["ŸäŸéÿ±ŸíŸÉŸéÿπŸè", "ŸÖŸèÿ≥ŸíŸÑŸêŸÖŸãÿß"] },
            { level: 3, category: "L3: Fi'il Mudhari", indonesian: "Fatimah sedang menulis", correctWords: ["ÿ™ŸéŸÉŸíÿ™Ÿèÿ®Ÿè", "ŸÅŸéÿßÿ∑ŸêŸÖŸéÿ©Ÿè"], distractors: ["ŸÉŸéÿ™Ÿéÿ®Ÿéÿ™Ÿí", "ŸÅŸéÿßÿ∑ŸêŸÖŸéÿ©Ÿé"] }, 
            { level: 3, category: "L3: Fi'il Mudhari", indonesian: "Aisyah sedang membaca", correctWords: ["ÿ™ŸéŸÇŸíÿ±Ÿéÿ£Ÿè", "ÿπŸéÿßÿ¶Ÿêÿ¥Ÿéÿ©Ÿè"], distractors: ["ŸÇŸéÿ±Ÿéÿ£Ÿéÿ™Ÿí", "ÿπŸéÿßÿ¶Ÿêÿ¥Ÿéÿ©Ÿé"] }, 
            { level: 3, category: "L3: Fi'il Mudhari", indonesian: "Zaid sedang berdiri", correctWords: ["ŸäŸéŸÇŸèŸàŸÖŸè", "ÿ≤ŸéŸäŸíÿØŸå"], distractors: ["ŸÇŸéÿßŸÖŸé", "ÿ≤ŸéŸäŸíÿØŸãÿß"] }, 
            { level: 3, category: "L3: Fi'il Mudhari", indonesian: "Pegawai itu sedang keluar", correctWords: ["ŸäŸéÿÆŸíÿ±Ÿèÿ¨Ÿè", "ÿßŸÑŸíŸÖŸèŸàŸéÿ∏ŸëŸéŸÅŸè"], distractors: ["ÿÆŸéÿ±Ÿéÿ¨Ÿé", "ŸÖŸèŸàŸéÿ∏ŸëŸéŸÅŸå"] },
            { level: 3, category: "L3: Fi'il Mudhari", indonesian: "Guru (lk) itu sedang menjawab", correctWords: ["ŸäŸèÿ¨ŸêŸäÿ®Ÿè", "ÿßŸÑŸíŸÖŸèÿØŸéÿ±ŸëŸêÿ≥Ÿè"], distractors: ["ÿ£Ÿéÿ¨Ÿéÿßÿ®Ÿé", "ŸÖŸèÿØŸéÿ±ŸëŸêÿ≥Ÿãÿß"] },
            { level: 3, category: "L3: Fi'il Mudhari", indonesian: "Anak (lk) itu sedang menangis", correctWords: ["ŸäŸéÿ®ŸíŸÉŸêŸä", "ÿßŸÑŸíŸàŸéŸÑŸéÿØŸè"], distractors: ["ÿ®ŸéŸÉŸéŸâ", "ŸàŸéŸÑŸéÿØŸãÿß"] },
            { level: 3, category: "L3: Fi'il Mudhari", indonesian: "Siswa itu sedang belajar", correctWords: ["ŸäŸéÿØŸíÿ±Ÿèÿ≥Ÿè", "ÿßŸÑÿ∑ŸëŸéÿßŸÑŸêÿ®Ÿè"], distractors: ["ÿØŸéÿ±Ÿéÿ≥Ÿé", "ÿ∑ŸéÿßŸÑŸêÿ®Ÿå"] },
            { level: 3, category: "L3: Fi'il Mudhari", indonesian: "Orang muslim sedang berpuasa", correctWords: ["ŸäŸéÿµŸèŸàŸÖŸè", "ÿßŸÑŸíŸÖŸèÿ≥ŸíŸÑŸêŸÖŸè"], distractors: ["ÿµŸéÿßŸÖŸé", "ŸÖŸèÿ≥ŸíŸÑŸêŸÖŸãÿß"] },
            { level: 3, category: "L3: Fi'il Mudhari", indonesian: "Ayah sedang bersafar", correctWords: ["ŸäŸèÿ≥ŸéÿßŸÅŸêÿ±Ÿè", "ÿßŸÑŸíÿ£Ÿéÿ®Ÿè"], distractors: ["ÿ≥ŸéÿßŸÅŸéÿ±Ÿé", "ÿ£Ÿéÿ®Ÿãÿß"] },
            { level: 3, category: "L3: Fi'il Mudhari", indonesian: "Ibu sedang mencuci", correctWords: ["ÿ™Ÿéÿ∫Ÿíÿ≥ŸêŸÑŸè", "ÿßŸÑŸíÿ£ŸèŸÖŸëŸè"], distractors: ["ÿ∫Ÿéÿ≥ŸéŸÑŸéÿ™Ÿí", "ÿ£ŸèŸÖŸëŸãÿß"] },
            { level: 3, category: "L3: Fi'il Mudhari", indonesian: "Fatimah sedang menyeterika", correctWords: ["ÿ™ŸéŸÉŸíŸàŸêŸä", "ŸÅŸéÿßÿ∑ŸêŸÖŸéÿ©Ÿè"], distractors: ["ŸÉŸéŸàŸéÿ™Ÿí", "ŸÅŸéÿßÿ∑ŸêŸÖŸéÿ©Ÿé"] },
            { level: 3, category: "L3: Fi'il Mudhari", indonesian: "Anak (lk) sedang mandi", correctWords: ["ŸäŸéÿ≥Ÿíÿ™Ÿéÿ≠ŸêŸÖŸëŸè", "ÿßŸÑŸíŸàŸéŸÑŸéÿØŸè"], distractors: ["ÿßŸêÿ≥Ÿíÿ™Ÿéÿ≠ŸéŸÖŸëŸé", "ŸàŸéŸÑŸéÿØŸãÿß"] },
            { level: 3, category: "L3: Fi'il Mudhari", indonesian: "Pemain sedang berlari", correctWords: ["ŸäŸéÿ¨Ÿíÿ±ŸêŸä", "ÿßŸÑŸÑŸëŸéÿßÿπŸêÿ®Ÿè"], distractors: ["ÿ¨Ÿéÿ±ŸéŸâ", "ŸÑŸéÿßÿπŸêÿ®Ÿãÿß"] },
            { level: 3, category: "L3: Fi'il Mudhari", indonesian: "Orang muslim sedang sujud", correctWords: ["ŸäŸéÿ≥Ÿíÿ¨ŸèÿØŸè", "ÿßŸÑŸíŸÖŸèÿ≥ŸíŸÑŸêŸÖŸè"], distractors: ["ÿ≥Ÿéÿ¨ŸéÿØŸé", "ŸÖŸèÿ≥ŸíŸÑŸêŸÖŸãÿß"] },

            // === LEVEL 4: MAHIR (SPOK / KOMPLEKS / ALTERNATIF JAWABAN) ===
            { 
                level: 4, 
                category: "L4: Kalimat Lengkap", 
                indonesian: "Ibu sedang mencuci piring kotor", 
                correctWords: ["ÿ™Ÿéÿ∫Ÿíÿ≥ŸêŸÑŸè", "ÿßŸÑŸíÿ£ŸèŸÖŸëŸè", "ÿßŸÑÿµŸëŸéÿ≠ŸíŸÜŸé", "ÿßŸÑŸíŸàŸéÿ≥ŸêÿÆŸé"], 
                distractors: ["ÿµŸéÿ≠ŸíŸÜŸãÿß", "ŸàŸéÿ≥ŸêÿÆŸãÿß"], 
                alternatives: [["ÿ™Ÿéÿ∫Ÿíÿ≥ŸêŸÑŸè", "ÿßŸÑŸíÿ£ŸèŸÖŸëŸè", "ÿµŸéÿ≠ŸíŸÜŸãÿß", "ŸàŸéÿ≥ŸêÿÆŸãÿß"]] 
            },
            { 
                level: 4, 
                category: "L4: Kalimat Lengkap", 
                indonesian: "Ibu sedang memasak makanan", 
                correctWords: ["ÿ™Ÿéÿ∑Ÿíÿ®ŸèÿÆŸè", "ÿßŸÑŸíÿ£ŸèŸÖŸëŸè", "ÿßŸÑÿ∑ŸëŸéÿπŸéÿßŸÖŸé"], 
                distractors: ["ÿ∑ŸéÿπŸéÿßŸÖŸãÿß", "ÿ∑Ÿéÿ®ŸéÿÆŸéÿ™Ÿí"],
                alternatives: [["ÿ™Ÿéÿ∑Ÿíÿ®ŸèÿÆŸè", "ÿßŸÑŸíÿ£ŸèŸÖŸëŸè", "ÿ∑ŸéÿπŸéÿßŸÖŸãÿß"]] 
            },
            { 
                level: 4, 
                category: "L4: Kalimat Lengkap", 
                indonesian: "Saya sedang membaca buku", 
                correctWords: ["ÿ£ŸéŸÇŸíÿ±Ÿéÿ£Ÿè", "ÿßŸÑŸíŸÉŸêÿ™Ÿéÿßÿ®Ÿé"], 
                distractors: ["ŸÉŸêÿ™Ÿéÿßÿ®Ÿãÿß", "ŸÇŸéÿ±Ÿéÿ£Ÿíÿ™Ÿè"],
                alternatives: [["ÿ£ŸéŸÇŸíÿ±Ÿéÿ£Ÿè", "ŸÉŸêÿ™Ÿéÿßÿ®Ÿãÿß"]] 
            },
            { 
                level: 4, 
                category: "L4: Kalimat Lengkap", 
                indonesian: "Zaid sedang meminum kopi panas", 
                correctWords: ["ŸäŸéÿ¥Ÿíÿ±Ÿéÿ®Ÿè", "ÿ≤ŸéŸäŸíÿØŸå", "ÿßŸÑŸíŸÇŸéŸáŸíŸàŸéÿ©Ÿé", "ÿßŸÑŸíÿ≠Ÿéÿßÿ±ŸëŸéÿ©Ÿé"], 
                distractors: ["ŸÇŸéŸáŸíŸàŸéÿ©Ÿã", "ÿ≠Ÿéÿßÿ±ŸëŸéÿ©Ÿã", "ÿ¥Ÿéÿ±Ÿêÿ®Ÿé"],
                alternatives: [["ŸäŸéÿ¥Ÿíÿ±Ÿéÿ®Ÿè", "ÿ≤ŸéŸäŸíÿØŸå", "ŸÇŸéŸáŸíŸàŸéÿ©Ÿã", "ÿ≠Ÿéÿßÿ±ŸëŸéÿ©Ÿã"]] 
            },
            { 
                level: 4, 
                category: "L4: Kalimat Lengkap", 
                indonesian: "Pedagang sedang menjual kemeja baru", 
                correctWords: ["ŸäŸéÿ®ŸêŸäÿπŸè", "ÿßŸÑÿ™ŸëŸéÿßÿ¨Ÿêÿ±Ÿè", "ÿßŸÑŸíŸÇŸéŸÖŸêŸäÿµŸé", "ÿßŸÑŸíÿ¨ŸéÿØŸêŸäÿØŸé"], 
                distractors: ["ŸÇŸéŸÖŸêŸäÿµŸãÿß", "ÿ¨ŸéÿØŸêŸäÿØŸãÿß", "ÿ®ŸéÿßÿπŸé"],
                alternatives: [["ŸäŸéÿ®ŸêŸäÿπŸè", "ÿßŸÑÿ™ŸëŸéÿßÿ¨Ÿêÿ±Ÿè", "ŸÇŸéŸÖŸêŸäÿµŸãÿß", "ÿ¨ŸéÿØŸêŸäÿØŸãÿß"]] 
            },
            { 
                level: 4, 
                category: "L4: Kalimat Lengkap", 
                indonesian: "Ayah sedang membeli mobil", 
                correctWords: ["ŸäŸéÿ¥Ÿíÿ™Ÿéÿ±ŸêŸä", "ÿßŸÑŸíÿ£Ÿéÿ®Ÿè", "ÿßŸÑÿ≥ŸëŸéŸäŸëŸéÿßÿ±Ÿéÿ©Ÿé"], 
                distractors: ["ÿ≥ŸéŸäŸëŸéÿßÿ±Ÿéÿ©Ÿã", "ÿßŸêÿ¥Ÿíÿ™Ÿéÿ±ŸéŸâ"],
                alternatives: [["ŸäŸéÿ¥Ÿíÿ™Ÿéÿ±ŸêŸä", "ÿßŸÑŸíÿ£Ÿéÿ®Ÿè", "ÿ≥ŸéŸäŸëŸéÿßÿ±Ÿéÿ©Ÿã"]] 
            },
            { 
                level: 4, 
                category: "L4: Kalimat Lengkap", 
                indonesian: "Hujan sedang turun dari langit", 
                correctWords: ["ŸäŸéŸÜŸíÿ≤ŸêŸÑŸè", "ÿßŸÑŸíŸÖŸéÿ∑Ÿéÿ±Ÿè", "ŸÖŸêŸÜŸé", "ÿßŸÑÿ≥ŸëŸéŸÖŸéÿßÿ°Ÿê"], 
                distractors: ["ÿ≥ŸéŸÖŸéÿßÿ°Ÿç", "ŸÜŸéÿ≤ŸéŸÑŸé"],
                alternatives: [["ŸäŸéŸÜŸíÿ≤ŸêŸÑŸè", "ÿßŸÑŸíŸÖŸéÿ∑Ÿéÿ±Ÿè", "ŸÖŸêŸÜŸí", "ÿ≥ŸéŸÖŸéÿßÿ°Ÿç"]] 
            },
            // Soal Level 4 Standar
            { level: 4, category: "L4: Objek Ma'rifah", indonesian: "Siswa sedang menghafal pelajaran itu", correctWords: ["ŸäŸéÿ≠ŸíŸÅŸéÿ∏Ÿè", "ÿßŸÑÿ∑ŸëŸéÿßŸÑŸêÿ®Ÿè", "ÿßŸÑÿØŸëŸéÿ±Ÿíÿ≥Ÿé"], distractors: ["ÿ≠ŸéŸÅŸêÿ∏Ÿé", "ÿßŸÑÿØŸëŸéÿ±Ÿíÿ≥Ÿè"] }, 
            { level: 4, category: "L4: Objek Ma'rifah", indonesian: "Kita sedang bersyukur kepada Allah", correctWords: ["ŸÜŸéÿ¥ŸíŸÉŸèÿ±Ÿè", "ÿßŸÑŸÑŸáŸé"], distractors: ["ÿ¥ŸéŸÉŸéÿ±ŸíŸÜŸéÿß", "ÿßŸÑŸÑŸáŸè"] }, 
            { level: 4, category: "L4: Objek Ma'rifah", indonesian: "Allah sedang memerintah sholat", correctWords: ["ŸäŸéÿ£ŸíŸÖŸèÿ±Ÿè", "ÿßŸÑŸÑŸáŸè", "ÿ®ŸêÿßŸÑÿµŸëŸéŸÑŸéÿßÿ©Ÿê"], distractors: ["ÿ£ŸéŸÖŸéÿ±Ÿé", "ÿµŸéŸÑŸéÿßÿ©Ÿã"] },
            { level: 4, category: "L4: Objek Ma'rifah", indonesian: "Siswa telah mengambil pena itu", correctWords: ["ÿ£ŸéÿÆŸéÿ∞Ÿé", "ÿßŸÑÿ∑ŸëŸéÿßŸÑŸêÿ®Ÿè", "ÿßŸÑŸíŸÇŸéŸÑŸéŸÖŸé"], distractors: ["ŸäŸéÿ£ŸíÿÆŸèÿ∞Ÿè", "ŸÇŸéŸÑŸéŸÖŸãÿß"] },
            { level: 4, category: "L4: Huruf Jar (Bi)", indonesian: "Saya sedang menulis dengan pena", correctWords: ["ÿ£ŸéŸÉŸíÿ™Ÿèÿ®Ÿè", "ÿ®ŸêÿßŸÑŸíŸÇŸéŸÑŸéŸÖŸê"], distractors: ["ŸÉŸéÿ™Ÿéÿ®Ÿíÿ™Ÿè", "ŸÇŸéŸÑŸéŸÖŸãÿß"] },
            { level: 4, category: "L4: Huruf Jar (Bi)", indonesian: "Kita sedang pergi dengan mobil", correctWords: ["ŸÜŸéÿ∞ŸíŸáŸéÿ®Ÿè", "ÿ®ŸêÿßŸÑÿ≥ŸëŸéŸäŸëŸéÿßÿ±Ÿéÿ©Ÿê"], distractors: ["ÿ∞ŸéŸáŸéÿ®ŸíŸÜŸéÿß", "ÿ≥ŸéŸäŸëŸéÿßÿ±Ÿéÿ©Ÿã"] },
            { level: 4, category: "L4: Huruf Jar (Bi)", indonesian: "Zaid telah memukul anjing dengan batu", correctWords: ["ÿ∂Ÿéÿ±Ÿéÿ®Ÿé", "ÿ≤ŸéŸäŸíÿØŸå", "ÿßŸÑŸíŸÉŸéŸÑŸíÿ®Ÿé", "ÿ®ŸêÿßŸÑŸíÿ≠Ÿéÿ¨Ÿéÿ±Ÿê"], distractors: ["ŸäŸéÿ∂Ÿíÿ±Ÿêÿ®Ÿè", "ÿ≠Ÿéÿ¨Ÿéÿ±Ÿãÿß"] },
            { level: 4, category: "L4: Huruf Jar (Li)", indonesian: "Buku ini milik Muhammad", correctWords: ["ŸáŸéÿ∞Ÿéÿß", "ÿßŸÑŸíŸÉŸêÿ™Ÿéÿßÿ®Ÿè", "ŸÑŸêŸÖŸèÿ≠ŸéŸÖŸëŸéÿØŸç"], distractors: ["ŸÑŸê", "ŸÖŸèÿ≠ŸéŸÖŸëŸéÿØŸå"] },
            { level: 4, category: "L4: Huruf Jar (Ka)", indonesian: "Wajahmu seperti bulan", correctWords: ["ŸàŸéÿ¨ŸíŸáŸèŸÉŸé", "ŸÉŸéÿßŸÑŸíŸÇŸéŸÖŸéÿ±Ÿê"], distractors: ["ŸÉŸé", "ŸÇŸéŸÖŸéÿ±Ÿå"] },
            { level: 4, category: "L4: 'Athof (Wa)", indonesian: "Langit dan Bumi", correctWords: ["ÿßŸÑÿ≥ŸëŸéŸÖŸéÿßÿ°Ÿè", "ŸàŸé", "ÿßŸÑŸíÿ£Ÿéÿ±Ÿíÿ∂Ÿè"], distractors: ["ÿ£Ÿéÿ±Ÿíÿ∂Ÿãÿß", "ŸÅŸêŸä"] },
            { level: 4, category: "L4: 'Athof (Wa)", indonesian: "Allah sedang menghidupkan dan mematikan", correctWords: ["ŸäŸèÿ≠ŸíŸäŸêŸä", "ÿßŸÑŸÑŸáŸè", "ŸàŸé", "ŸäŸèŸÖŸêŸäÿ™Ÿè"], distractors: ["ÿ£Ÿéÿ≠ŸíŸäŸéÿß", "ÿ£ŸéŸÖŸéÿßÿ™Ÿé"] },
            { level: 4, category: "L4: 'Athof (Au)", indonesian: "Kamu mau teh atau kopi?", correctWords: ["ÿ™Ÿèÿ±ŸêŸäÿØŸè", "ÿ¥ŸéÿßŸäŸãÿß", "ÿ£ŸéŸàŸí", "ŸÇŸéŸáŸíŸàŸéÿ©Ÿã"], distractors: ["ÿ¥ŸéÿßŸäŸå", "ŸÇŸéŸáŸíŸàŸéÿ©Ÿå"] },
            { level: 4, category: "L4: 'Athof (Tsumma)", indonesian: "Zaid telah datang kemudian Umar", correctWords: ["ÿ¨Ÿéÿßÿ°Ÿé", "ÿ≤ŸéŸäŸíÿØŸå", "ÿ´ŸèŸÖŸëŸé", "ÿπŸèŸÖŸéÿ±Ÿè"], distractors: ["ÿ£ŸéŸàŸí", "ÿπŸèŸÖŸéÿ±Ÿãÿß"] },
            { level: 4, category: "L4: 'Athof (Am)", indonesian: "Apakah kamu tidur atau bangun?", correctWords: ["ÿ£ŸéŸÜŸéÿßÿ¶ŸêŸÖŸå", "ÿ£ŸéŸÜŸíÿ™Ÿé", "ÿ£ŸéŸÖŸí", "ŸÖŸèÿ≥Ÿíÿ™ŸéŸäŸíŸÇŸêÿ∏Ÿå"], distractors: ["ÿ£ŸéŸàŸí", "ŸÜŸéÿßÿ¶ŸêŸÖŸãÿß"] },
            { level: 4, category: "L4: Kalimat Lengkap", indonesian: "Saya sedang sholat di masjid berjamaah", correctWords: ["ÿ£ŸèÿµŸéŸÑŸëŸêŸä", "ŸÅŸêŸä", "ÿßŸÑŸíŸÖŸéÿ≥Ÿíÿ¨ŸêÿØŸê", "ÿ¨ŸéŸÖŸéÿßÿπŸéÿ©Ÿã"], distractors: ["ÿµŸéŸÑŸëŸéŸäŸíÿ™Ÿè", "ŸÖŸèÿµŸéŸÑŸëŸéŸâ"] }, 
            { level: 4, category: "L4: Kalimat Lengkap", indonesian: "Fatimah sedang menutup pintu rumah", correctWords: ["ÿ™Ÿèÿ∫ŸíŸÑŸêŸÇŸè", "ŸÅŸéÿßÿ∑ŸêŸÖŸéÿ©Ÿè", "ÿ®Ÿéÿßÿ®Ÿé", "ÿßŸÑŸíÿ®ŸéŸäŸíÿ™Ÿê"], distractors: ["ÿ£Ÿéÿ∫ŸíŸÑŸéŸÇŸéÿ™Ÿí", "ÿ®Ÿéÿßÿ®Ÿãÿß"] },
            { level: 4, category: "L4: Kalimat Lengkap", indonesian: "Ayah sedang pulang dari kantor", correctWords: ["ŸäŸéÿ±Ÿíÿ¨ŸêÿπŸè", "ÿßŸÑŸíÿ£Ÿéÿ®Ÿè", "ŸÖŸêŸÜŸé", "ÿßŸÑŸíŸÖŸéŸÉŸíÿ™Ÿéÿ®Ÿê"], distractors: ["ÿ±Ÿéÿ¨ŸéÿπŸé", "ÿ•ŸêŸÑŸéŸâ"] },
            { level: 4, category: "L4: Kalimat Lengkap", indonesian: "Petani telah pergi ke sawah pagi hari", correctWords: ["ÿ∞ŸéŸáŸéÿ®Ÿé", "ÿßŸÑŸíŸÅŸéŸÑŸéŸëÿßÿ≠Ÿè", "ÿ•ŸêŸÑŸéŸâ", "ÿßŸÑŸíŸÖŸéÿ≤Ÿíÿ±ŸéÿπŸéÿ©Ÿê", "ÿµŸéÿ®Ÿéÿßÿ≠Ÿãÿß"], distractors: ["ŸäŸéÿ∞ŸíŸáŸéÿ®Ÿè", "ŸÖŸéÿ≥Ÿéÿßÿ°Ÿã"] },
            { level: 4, category: "L4: Kalimat Lengkap", indonesian: "Para siswa sedang membaca Al-Qur'an di kelas", correctWords: ["ŸäŸéŸÇŸíÿ±Ÿéÿ£Ÿè", "ÿßŸÑÿ∑ŸëŸèŸÑŸëŸéÿßÿ®Ÿè", "ÿßŸÑŸíŸÇŸèÿ±Ÿíÿ¢ŸÜŸé", "ŸÅŸêŸä", "ÿßŸÑŸíŸÅŸéÿµŸíŸÑŸê"], distractors: ["ŸÇŸéÿ±Ÿéÿ£Ÿé", "ÿßŸÑŸíŸÇŸèÿ±Ÿíÿ¢ŸÜŸè"] },
            { level: 4, category: "L4: Kalimat Lengkap", indonesian: "Siswa (lk) sedang duduk di atas kursi", correctWords: ["ŸäŸéÿ¨ŸíŸÑŸêÿ≥Ÿè", "ÿßŸÑÿ∑ŸëŸéÿßŸÑŸêÿ®Ÿè", "ÿπŸéŸÑŸéŸâ", "ÿßŸÑŸíŸÉŸèÿ±Ÿíÿ≥ŸêŸäŸëŸê"], distractors: ["ÿ¨ŸéŸÑŸéÿ≥Ÿé", "ŸÅŸêŸä"] },
            { level: 4, category: "L4: Kalimat Lengkap", indonesian: "Singa itu sedang tidur di hutan", correctWords: ["ŸäŸéŸÜŸéÿßŸÖŸè", "ÿßŸÑŸíÿ£Ÿéÿ≥ŸéÿØŸè", "ŸÅŸêŸä", "ÿßŸÑŸíÿ∫Ÿéÿßÿ®Ÿéÿ©Ÿê"], distractors: ["ŸÜŸéÿßŸÖŸé", "ÿ£Ÿéÿ≥ŸéÿØŸå"] },
            { level: 4, category: "L4: Kalimat Lengkap", indonesian: "Ibu sedang mencuci piring kotor", correctWords: ["ÿ™Ÿéÿ∫Ÿíÿ≥ŸêŸÑŸè", "ÿßŸÑŸíÿ£ŸèŸÖŸëŸè", "ÿßŸÑÿµŸëŸéÿ≠ŸíŸÜŸé", "ÿßŸÑŸíŸàŸéÿ≥ŸêÿÆŸé"], distractors: ["ÿµŸéÿ≠ŸíŸÜŸãÿß", "ŸàŸéÿ≥ŸêÿÆŸãÿß"] },
            { level: 4, category: "L4: Kalimat Lengkap", indonesian: "Guru (lk) sedang berdiri di depan kelas", correctWords: ["ŸäŸéŸÇŸèŸàŸÖŸè", "ÿßŸÑŸíŸÖŸèÿØŸéÿ±ŸëŸêÿ≥Ÿè", "ÿ£ŸéŸÖŸéÿßŸÖŸé", "ÿßŸÑŸíŸÅŸéÿµŸíŸÑŸê"], distractors: ["ŸÇŸéÿßŸÖŸé", "ŸàŸéÿ±Ÿéÿßÿ°Ÿé"] },
            { level: 4, category: "L4: Kalimat Lengkap", indonesian: "Hujan sedang turun dari langit", correctWords: ["ŸäŸéŸÜŸíÿ≤ŸêŸÑŸè", "ÿßŸÑŸíŸÖŸéÿ∑Ÿéÿ±Ÿè", "ŸÖŸêŸÜŸé", "ÿßŸÑÿ≥ŸëŸéŸÖŸéÿßÿ°Ÿê"], distractors: ["ŸÜŸéÿ≤ŸéŸÑŸé", "ÿ≥ŸéŸÖŸéÿßÿ°Ÿç"] },
            { level: 4, category: "L4: Kalimat Lengkap", indonesian: "Zaid sedang menginginkan air", correctWords: ["ŸäŸèÿ±ŸêŸäÿØŸè", "ÿ≤ŸéŸäŸíÿØŸå", "ÿßŸÑŸíŸÖŸéÿßÿ°Ÿé"], distractors: ["ÿ£Ÿéÿ±ŸéÿßÿØŸé", "ŸÖŸéÿßÿ°Ÿã"] },
            { level: 4, category: "L4: Kalimat Lengkap", indonesian: "Siswa telah meminjam buku dari perpustakaan", correctWords: ["ÿßŸêÿ≥Ÿíÿ™ŸéÿπŸéÿßÿ±Ÿé", "ÿßŸÑÿ∑ŸëŸéÿßŸÑŸêÿ®Ÿè", "ÿßŸÑŸíŸÉŸêÿ™Ÿéÿßÿ®Ÿé", "ŸÖŸêŸÜŸé", "ÿßŸÑŸíŸÖŸéŸÉŸíÿ™Ÿéÿ®Ÿéÿ©Ÿê"], distractors: ["ŸäŸéÿ≥Ÿíÿ™ŸéÿπŸêŸäÿ±Ÿè", "ŸÉŸêÿ™Ÿéÿßÿ®Ÿãÿß"] },
            { level: 4, category: "L4: Kalimat Lengkap", indonesian: "Saya sedang membantu ibu di dapur", correctWords: ["ÿ£Ÿèÿ≥ŸéÿßÿπŸêÿØŸè", "ÿßŸÑŸíÿ£ŸèŸÖŸëŸé", "ŸÅŸêŸä", "ÿßŸÑŸíŸÖŸéÿ∑Ÿíÿ®ŸéÿÆŸê"], distractors: ["ÿ≥ŸéÿßÿπŸéÿØŸíÿ™Ÿè", "ÿ£ŸèŸÖŸëŸãÿß"] }
        ];

        // --- UTILS & STORAGE ---
        const LEADERBOARD_KEY = 'tarkib_legend_leaderboard_v2'; // Update key
        
        const getLeaderboard = () => {
            const stored = localStorage.getItem(LEADERBOARD_KEY);
            return stored ? JSON.parse(stored) : [];
        };

        const saveScoreToLeaderboard = (name, score, level) => {
            const current = getLeaderboard();
            const newEntry = { name, score, level, date: new Date().toLocaleDateString() };
            const updated = [...current, newEntry].sort((a, b) => b.score - a.score).slice(0, 50); 
            localStorage.setItem(LEADERBOARD_KEY, JSON.stringify(updated));
        };

        const downloadCSV = () => {
            const scores = getLeaderboard();
            if (scores.length === 0) { alert("Belum ada data."); return; }
            let csvContent = "data:text/csv;charset=utf-8,No,Nama,Level,Skor,Tanggal\n"; 
            scores.forEach((row, i) => csvContent += `${i + 1},"${row.name}",${row.level},${row.score},${row.date}\n`);
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "tarkib_legend_scores.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        const shuffleArray = (array) => {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };

        // --- COMPONENTS ---

        const Leaderboard = ({ onClose }) => {
            const scores = getLeaderboard();
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in" onPointerDown={(e) => e.stopPropagation()}>
                    <div className="bg-white rounded-3xl max-w-md w-full p-6 shadow-2xl pop-in relative overflow-hidden flex flex-col max-h-[80vh]">
                        <div className="absolute top-0 left-0 w-full h-20 bg-gradient-to-b from-yellow-100 to-white -z-10"></div>
                        <h2 className="text-3xl font-bold text-center text-yellow-600 mb-2 flex items-center justify-center gap-2"><span>üèÜ</span> Papan Skor</h2>
                        <div className="flex-grow overflow-y-auto scrollbar-hide mb-4 border rounded-xl bg-gray-50">
                            <table className="w-full text-left border-collapse">
                                <thead className="bg-gray-100 text-gray-600 text-sm uppercase sticky top-0 shadow-sm">
                                    <tr><th className="p-3">#</th><th className="p-3">Nama</th><th className="p-3">Lvl</th><th className="p-3 text-right">Skor</th></tr>
                                </thead>
                                <tbody>
                                    {scores.length === 0 ? (<tr><td colSpan="4" className="p-6 text-center text-gray-400 italic">Belum ada data</td></tr>) : (
                                        scores.map((entry, idx) => (
                                            <tr key={idx} className={`border-b last:border-0 ${idx < 3 ? 'bg-yellow-50/50' : ''}`}>
                                                <td className="p-3 font-bold text-gray-500">{idx+1}</td>
                                                <td className="p-3 font-bold text-gray-800">{entry.name}</td>
                                                <td className="p-3 text-sm text-gray-500">{entry.level}</td>
                                                <td className="p-3 text-right font-mono font-bold text-emerald-600">{entry.score}</td>
                                            </tr>
                                        ))
                                    )}
                                </tbody>
                            </table>
                        </div>
                        <div className="flex flex-col gap-2">
                            <button onPointerDown={(e) => { e.preventDefault(); downloadCSV(); }} className="w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700 transition">üì• Download Laporan (Excel)</button>
                            <button onPointerDown={(e) => { e.preventDefault(); onClose(); }} className="w-full bg-gray-800 text-white font-bold py-3 rounded-xl hover:bg-black transition">Tutup</button>
                        </div>
                    </div>
                </div>
            );
        };

        const NameInput = ({ mode, onNext, onCancel }) => {
            const [p1Name, setP1Name] = React.useState("");
            const [p2Name, setP2Name] = React.useState("");
            const handleSubmit = (e) => {
                e.preventDefault();
                if (mode === 'single' && p1Name.trim()) onNext(p1Name, null);
                else if (mode === 'duel' && p1Name.trim() && p2Name.trim()) onNext(p1Name, p2Name);
            };
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in" onPointerDown={(e) => e.stopPropagation()}>
                    <div className="bg-white rounded-3xl max-w-md w-full p-8 shadow-2xl pop-in">
                        <h2 className="text-2xl font-bold text-emerald-800 mb-2 text-center">Siapa yang main?</h2>
                        <form onSubmit={handleSubmit} className="space-y-4 mt-4">
                            <div><label className="block text-sm font-bold text-gray-700 mb-1">Nama Player 1 {mode === 'duel' && '(Kiri)'}</label><input type="text" value={p1Name} onChange={(e) => setP1Name(e.target.value)} className="w-full border-2 border-gray-200 rounded-xl p-3 focus:border-emerald-500 focus:outline-none" placeholder="Tulis nama..." maxLength="12" autoFocus /></div>
                            {mode === 'duel' && (<div><label className="block text-sm font-bold text-gray-700 mb-1">Nama Player 2 (Kanan)</label><input type="text" value={p2Name} onChange={(e) => setP2Name(e.target.value)} className="w-full border-2 border-gray-200 rounded-xl p-3 focus:border-orange-500 focus:outline-none" placeholder="Tulis nama..." maxLength="12" /></div>)}
                            <div className="pt-4 flex gap-3"><button type="button" onPointerDown={(e) => {e.preventDefault(); onCancel();}} className="flex-1 bg-gray-100 text-gray-600 font-bold py-3 rounded-xl hover:bg-gray-200">Batal</button><button type="submit" onPointerDown={(e) => {if((!p1Name || (mode === 'duel' && !p2Name))) return; e.preventDefault(); handleSubmit(e);}} disabled={!p1Name || (mode === 'duel' && !p2Name)} className="flex-1 bg-emerald-600 text-white font-bold py-3 rounded-xl hover:bg-emerald-700 disabled:opacity-50">Lanjut Pilih Level</button></div>
                        </form>
                    </div>
                </div>
            );
        };

        const LevelSelect = ({ onSelectLevel, onBack }) => {
            const levels = [
                { id: 1.1, title: "Level 1A", subtitle: "Jar Majrur & Zharaf", desc: "Contoh: Di atas meja, Di depan kelas" },
                { id: 1.2, title: "Level 1B", subtitle: "Idhafah (Sandaran)", desc: "Contoh: Pintu masjid, Kitab Allah" },
                { id: 1.3, title: "Level 1C", subtitle: "Na'at Man'ut (Sifat)", desc: "Contoh: Buku baru, Rumah besar" },
                { id: 2, title: "Level 2", subtitle: "Jumlah Ismiyah", desc: "Mubtada & Khobar" },
                { id: 3, title: "Level 3", subtitle: "Jumlah Fi'liyah", desc: "Fi'il Madhi & Mudhari" },
                { id: 4, title: "Level 4", subtitle: "Mahir", desc: "Kalimat Kompleks & SPOK" }
            ];
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in" onPointerDown={(e) => e.stopPropagation()}>
                    <div className="bg-white rounded-3xl max-w-lg w-full p-6 shadow-2xl pop-in">
                        <div className="flex justify-between items-center mb-4"><h2 className="text-2xl font-bold text-emerald-800">Pilih Tingkatan</h2><button onPointerDown={(e) => {e.preventDefault(); onBack();}} className="text-gray-400 hover:text-red-500 font-bold w-10 h-10 flex items-center justify-center">‚úï</button></div>
                        <div className="grid grid-cols-1 gap-3">
                            {levels.map((lvl) => (
                                <button key={lvl.id} onPointerDown={(e) => { e.preventDefault(); onSelectLevel(lvl.id); }} className="flex items-center p-4 rounded-xl border-2 border-emerald-100 hover:border-emerald-500 hover:bg-emerald-50 transition group text-left w-full">
                                    <div className="bg-emerald-100 text-emerald-600 font-bold w-12 h-12 rounded-full flex items-center justify-center text-xl group-hover:bg-emerald-500 group-hover:text-white transition">{Math.floor(lvl.id)}</div>
                                    <div className="ml-4"><h3 className="font-bold text-gray-800 text-lg">{lvl.title}: {lvl.subtitle}</h3><p className="text-sm text-gray-500">{lvl.desc}</p></div>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const MainMenu = ({ onModeSelect, onShowRules, onShowLeaderboard }) => (
            <div className="min-h-screen flex flex-col items-center justify-center p-6 relative overflow-hidden bg-emerald-50">
                <div className="absolute inset-0 bg-pattern"></div>
                <div className="z-10 w-full max-w-md bg-white/90 backdrop-blur-sm p-8 rounded-3xl shadow-2xl border-4 border-emerald-100 text-center pop-in">
                    <div className="mb-6 flex justify-center">
                        <img src="logo.png" alt="Logo Sekolah" className="h-28 w-auto object-contain" onError={(e) => { e.target.onerror = null; e.target.style.display = 'none'; e.target.nextSibling.style.display = 'block'; }} />
                        <div style={{display: 'none'}} className="text-6xl">üïå</div>
                    </div>
                    <h1 className="text-4xl font-extrabold text-emerald-800 mb-2 font-serif tracking-wide">TARKIB LEGEND</h1>
                    <p className="text-emerald-600 font-semibold mb-8">Game Edukasi Bahasa Arab</p>
                    <div className="space-y-3">
                        <button onPointerDown={(e) => {e.preventDefault(); onModeSelect('single');}} className="w-full bg-emerald-600 hover:bg-emerald-700 text-white text-xl font-bold py-4 rounded-2xl shadow-lg transition transform hover:scale-105 flex items-center justify-center gap-3"><span>üë§</span> 1 Pemain</button>
                        <button onPointerDown={(e) => {e.preventDefault(); onModeSelect('duel');}} className="w-full bg-orange-500 hover:bg-orange-600 text-white text-xl font-bold py-4 rounded-2xl shadow-lg transition transform hover:scale-105 flex items-center justify-center gap-3"><span>‚öîÔ∏è</span> Duel 2 Pemain</button>
                        <div className="flex gap-3">
                            <button onPointerDown={(e) => {e.preventDefault(); onShowLeaderboard();}} className="flex-1 bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-3 rounded-2xl shadow-md transition transform hover:scale-105 flex items-center justify-center gap-2">üèÜ Papan Skor</button>
                            <button onPointerDown={(e) => {e.preventDefault(); onShowRules();}} className="flex-1 bg-white hover:bg-gray-50 text-emerald-700 font-bold py-3 rounded-2xl border-2 border-emerald-200 shadow-sm transition">üìú Aturan</button>
                        </div>
                    </div>
                </div>
                <div className="mt-8 z-10 text-center"><p className="text-xs text-emerald-800 font-bold uppercase tracking-widest mb-1">Pengembang</p><div className="bg-white px-6 py-2 rounded-full shadow-sm border border-emerald-100"><p className="text-emerald-700 font-bold text-sm">SDIT Qurratu A'yun Al-Islami Maros</p></div></div>
            </div>
        );

        const RulesModal = ({ onClose }) => (
            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in" onPointerDown={(e) => e.stopPropagation()}>
                <div className="bg-white rounded-3xl max-w-md w-full p-6 shadow-2xl pop-in">
                    <h2 className="text-2xl font-bold text-emerald-800 mb-4 border-b pb-2">Aturan Permainan</h2>
                    <ul className="space-y-3 text-gray-700 mb-6 text-sm">
                        <li className="flex gap-2"><span className="text-emerald-500 font-bold">1.</span> Pilih Level yang ingin dimainkan.</li>
                        <li className="flex gap-2"><span className="text-emerald-500 font-bold">2.</span> Susun kata Arab sesuai terjemahan.</li>
                        <li className="flex gap-2"><span className="text-emerald-500 font-bold">3.</span> <span className="font-bold">Tantangan Waktu:</span> Soal pertama 60 detik, semakin lama semakin cepat.</li>
                        <li className="flex gap-2"><span className="text-emerald-500 font-bold">4.</span> Gunakan tombol "Papan Skor" untuk mendownload data nilai siswa.</li>
                    </ul>
                    <button onPointerDown={(e) => {e.preventDefault(); onClose();}} className="w-full bg-emerald-600 text-white font-bold py-3 rounded-xl hover:bg-emerald-700">Tutup</button>
                </div>
            </div>
        );

        const GameBoard = ({ isDuel = false, playerName = "Player", playerIndex = 1, questionData, questionIndex, onCorrect, onWrong, score }) => {
            const [availableWords, setAvailableWords] = React.useState([]);
            const [selectedWords, setSelectedWords] = React.useState([]);
            const [localState, setLocalState] = React.useState('playing');
            const [shake, setShake] = React.useState(false);
            const [wrongIndices, setWrongIndices] = React.useState([]);
            const [timeLeft, setTimeLeft] = React.useState(60);

            const calculateInitialTime = (idx) => (idx === 0 ? 60 : idx === 1 ? 50 : 40);

            React.useEffect(() => {
                if(questionData) {
                    const allWords = [
                        ...questionData.correctWords.map((w, i) => ({ id: `c-${i}`, text: w })),
                        ...questionData.distractors.map((w, i) => ({ id: `d-${i}`, text: w }))
                    ];
                    setAvailableWords(shuffleArray(allWords));
                    setSelectedWords([]);
                    setLocalState('playing');
                    setWrongIndices([]);
                    setTimeLeft(calculateInitialTime(questionIndex)); 
                }
            }, [questionData, questionIndex]);

            React.useEffect(() => {
                let timer;
                if (localState === 'playing' && timeLeft > 0) {
                    timer = setInterval(() => { setTimeLeft((prev) => prev - 1); }, 1000);
                } else if (timeLeft === 0 && localState === 'playing') {
                    handleWrongLogic();
                }
                return () => clearInterval(timer);
            }, [timeLeft, localState]);

            const handleWrongLogic = () => {
                playWrongSound();
                setLocalState('wrong');
                setShake(true);
                setTimeout(() => setShake(false), 500);
                onWrong(); 
            };

            const handleWordClick = (e, word) => {
                e.preventDefault(); 
                if(localState === 'correct') return;
                setAvailableWords(prev => prev.filter(w => w.id !== word.id));
                setSelectedWords(prev => [...prev, word]); 
                setWrongIndices([]); 
            };

            const handleSelectedClick = (e, word) => {
                e.preventDefault(); 
                if(localState === 'correct') return;
                setSelectedWords(prev => prev.filter(w => w.id !== word.id));
                setAvailableWords(prev => [...prev, word]);
                setLocalState('playing');
                setWrongIndices([]); 
            };

            const checkAnswer = (e) => {
                e.preventDefault(); 
                if(localState === 'correct') return;
                
                // --- LOGIKA KOREKSI JAWABAN (UTAMA + ALTERNATIF) ---
                const targets = [questionData.correctWords, ...(questionData.alternatives || [])];
                
                const isCorrect = targets.some(target => 
                    selectedWords.length === target.length &&
                    selectedWords.every((w, i) => w.text === target[i])
                );

                if (isCorrect) {
                    playCorrectSound();
                    setLocalState('correct');
                    onCorrect();
                } else {
                    playWrongSound();
                    setLocalState('wrong');
                    setShake(true);
                    setTimeout(() => setShake(false), 500);

                    if (!isDuel) {
                        let bestMatchIndices = [];
                        let minMismatchCount = Infinity;

                        targets.forEach(target => {
                            let mismatches = [];
                            selectedWords.forEach((w, i) => {
                                if (!target[i] || w.text !== target[i]) {
                                    mismatches.push(i);
                                }
                            });
                            if (mismatches.length < minMismatchCount) {
                                minMismatchCount = mismatches.length;
                                bestMatchIndices = mismatches;
                            }
                        });
                        setWrongIndices(bestMatchIndices);
                    }
                    onWrong();
                }
            };

            const borderColor = playerIndex === 2 ? 'border-orange-500' : 'border-emerald-500';
            const dynamicAnswerFont = selectedWords.length > 4 ? 'text-2xl md:text-3xl' : 'text-3xl md:text-5xl';

            return (
                <div className={`flex flex-col h-full bg-white border-b-8 ${isDuel ? borderColor : 'border-emerald-500'} relative`}>
                    <div className="bg-gray-100 p-2 flex justify-between items-center px-4 border-b border-gray-200 select-none">
                        <div className="flex flex-col max-w-[30%]"><span className={`text-xs font-bold uppercase truncate ${playerIndex === 2 ? 'text-orange-600' : 'text-emerald-600'}`}>{playerName}</span><span className="text-xs text-gray-400">Level {questionData.level} - Soal {questionIndex + 1}</span></div>
                        <div className={`flex items-center gap-1 font-bold ${timeLeft <= 10 ? 'text-red-600 pulse-red' : 'text-gray-700'}`}><span>‚è±Ô∏è {timeLeft}</span></div>
                        <div className="bg-white px-2 py-1 rounded border border-gray-200"><span className="text-lg font-bold text-gray-800">‚≠ê {score}</span></div>
                    </div>
                    <div className="bg-emerald-50 p-4 text-center flex-grow flex items-center justify-center flex-col min-h-[100px] select-none">
                        <p className="text-gray-400 text-xs uppercase mb-1">{questionData.category}</p>
                        <h3 className="text-2xl md:text-3xl font-bold text-gray-800 leading-snug">"{questionData.indonesian}"</h3>
                    </div>
                    <div dir="rtl" className={`p-3 min-h-[120px] bg-white border-y border-gray-100 flex flex-wrap gap-2 justify-center items-center content-center transition-colors ${localState === 'wrong' ? 'bg-red-50' : ''}`}>
                        {selectedWords.length === 0 && <span className="text-sm text-gray-300 italic dir-ltr select-none">Susun kata di sini</span>}
                        {selectedWords.map((w, i) => {
                            const isWrong = wrongIndices.includes(i);
                            const btnStyle = isWrong ? "bg-red-100 border-red-500 text-red-600 animate-pulse" : "bg-white border-emerald-300 text-gray-800 hover:bg-red-50 hover:border-red-300";
                            return (
                                <button key={w.id} onPointerDown={(e) => handleSelectedClick(e, w)} className={`arabic-text ${dynamicAnswerFont} px-3 py-2 border-2 rounded-xl shadow-md transition-all ${btnStyle}`}>
                                    {w.text}
                                </button>
                            );
                        })}
                    </div>
                    <div className="p-4 bg-gray-50 flex flex-wrap gap-3 justify-center min-h-[120px] content-start overflow-y-auto">
                        {availableWords.map(w => (
                            <button key={w.id} onPointerDown={(e) => handleWordClick(e, w)} className="arabic-text text-2xl px-4 py-2 bg-white border border-gray-200 rounded-xl shadow-sm hover:bg-emerald-100 hover:border-emerald-300 hover:-translate-y-1 transition-all duration-200 text-emerald-800">
                                {w.text}
                            </button>
                        ))}
                    </div>
                    <div className="p-3">
                        {localState === 'correct' ? (
                            <div className="w-full bg-emerald-500 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 animate-pulse text-xl select-none"><span>‚ú® Mumtaz!</span></div>
                        ) : (
                            <button onPointerDown={checkAnswer} disabled={selectedWords.length === 0} className={`w-full font-bold py-4 rounded-xl shadow-md transition text-lg ${selectedWords.length === 0 ? 'bg-gray-200 text-gray-400' : 'bg-emerald-600 text-white active:scale-95 hover:bg-emerald-700'}`}>Cek Jawaban</button>
                        )}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = React.useState('menu'); 
            const [tempMode, setTempMode] = React.useState('single');
            const [selectedLevel, setSelectedLevel] = React.useState(null);
            
            const [sessionQuestions, setSessionQuestions] = React.useState([]);
            const [questionIdx, setQuestionIdx] = React.useState(0);

            const [p1Name, setP1Name] = React.useState("");
            const [p2Name, setP2Name] = React.useState("");

            const [spScore, setSpScore] = React.useState(0);
            const [spLives, setSpLives] = React.useState(3);
            const [spFinished, setSpFinished] = React.useState(false);

            const [p1Score, setP1Score] = React.useState(0);
            const [p2Score, setP2Score] = React.useState(0);
            const [duelRoundKey, setDuelRoundKey] = React.useState(0);

            const goHome = () => { setView('menu'); setSpFinished(false); }
            const goLevelSelect = () => { setSpFinished(false); setView('levelSelect'); }

            const handleModeSelect = (mode) => { setTempMode(mode); setView('inputName'); };
            const handleNameSubmit = (name1, name2) => { setP1Name(name1); if(name2) setP2Name(name2); setView('levelSelect'); };

            const handleLevelSelect = (levelId) => {
                setSelectedLevel(levelId);
                const filtered = gameDataDatabase.filter(q => q.level === levelId);
                const shuffled = shuffleArray(filtered);
                const sessionSet = shuffled.slice(0, 20); 
                setSessionQuestions(sessionSet);
                setQuestionIdx(0);
                if (tempMode === 'single') { setSpScore(0); setSpLives(3); setSpFinished(false); setView('single'); } 
                else { setP1Score(0); setP2Score(0); setDuelRoundKey(0); setView('duel'); }
            };

            const handleSpCorrect = () => {
                setSpScore(s => s + 100);
                setTimeout(() => {
                    if (questionIdx + 1 < sessionQuestions.length) {
                        setQuestionIdx(p => p + 1);
                    } else {
                        setSpFinished(true);
                        saveScoreToLeaderboard(p1Name, spScore + 100, selectedLevel);
                        if(selectedLevel === 4) { playGrandFanfare(); fireConfetti(2); } else { playLevelCompleteSound(); fireConfetti(1); }
                    }
                }, 1500);
            };

            const handleSpWrong = () => {
                setSpLives(l => l - 1);
                if (spLives <= 1) {
                    setSpFinished(true);
                    saveScoreToLeaderboard(p1Name, spScore, selectedLevel);
                }
            };

            const handleDuelWin = (winner) => {
                if (document.duelLocked) return;
                document.duelLocked = true;
                if (winner === 1) setP1Score(s => s + 1); else setP2Score(s => s + 1);
                setTimeout(() => {
                    if (questionIdx + 1 < sessionQuestions.length) {
                        setQuestionIdx(p => p + 1);
                        setDuelRoundKey(k => k + 1);
                        document.duelLocked = false;
                    } else {
                        setSpFinished(true);
                        if(selectedLevel === 4) { playGrandFanfare(); fireConfetti(2); } else { playLevelCompleteSound(); fireConfetti(1); }
                    }
                }, 1500);
            };

            if (view === 'menu') return <MainMenu onModeSelect={handleModeSelect} onShowRules={() => setView('rules')} onShowLeaderboard={() => setView('leaderboard')} />;
            if (view === 'rules') return <RulesModal onClose={goHome} />;
            if (view === 'leaderboard') return <Leaderboard onClose={goHome} />;
            if (view === 'inputName') return <NameInput mode={tempMode} onNext={handleNameSubmit} onCancel={goHome} />;
            if (view === 'levelSelect') return <LevelSelect onSelectLevel={handleLevelSelect} onBack={() => setView('inputName')} />;

            if (spFinished) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-emerald-50 p-6">
                        <div className="bg-white p-8 rounded-3xl shadow-2xl text-center max-w-sm w-full pop-in">
                            <h2 className="text-3xl font-bold text-emerald-800 mb-4">Permainan Selesai!</h2>
                            <p className="text-sm text-gray-500 mb-6">Level {selectedLevel}</p>
                            {view === 'duel' ? (
                                <div className="space-y-4 mb-8">
                                    <div className="flex gap-4 justify-center">
                                        <div className={`p-4 rounded-xl w-1/2 ${p1Score > p2Score ? 'bg-emerald-100 border-2 border-emerald-500' : 'bg-gray-100'}`}>
                                            <p className="font-bold text-gray-600 truncate">{p1Name}</p>
                                            <p className="text-4xl font-bold text-emerald-600">{p1Score}</p>
                                        </div>
                                        <div className={`p-4 rounded-xl w-1/2 ${p2Score > p1Score ? 'bg-orange-100 border-2 border-orange-500' : 'bg-gray-100'}`}>
                                            <p className="font-bold text-gray-600 truncate">{p2Name}</p>
                                            <p className="text-4xl font-bold text-orange-600">{p2Score}</p>
                                        </div>
                                    </div>
                                    <p className="text-xl font-bold mt-4">{p1Score === p2Score ? "Seri!" : (p1Score > p2Score ? `${p1Name} Menang!` : `${p2Name} Menang!`)}</p>
                                </div>
                            ) : (
                                <div className="mb-8">
                                    <p className="text-gray-500 font-bold mb-1">{p1Name}</p>
                                    <p className="text-sm text-gray-400 uppercase">Skor Akhir</p>
                                    <p className="text-6xl font-bold text-emerald-600 mb-2">{spScore}</p>
                                    <p className="text-sm text-yellow-600 bg-yellow-100 py-1 px-3 rounded-full inline-block">{spLives > 0 ? "üèÜ Tamat Sempurna" : "Disimpan di Papan Skor"}</p>
                                </div>
                            )}
                            <div className="flex flex-col gap-3">
                                <button onPointerDown={(e) => {e.preventDefault(); goLevelSelect();}} className="w-full bg-emerald-600 text-white font-bold py-3 rounded-xl hover:bg-emerald-700 transition">üìö Pilih Level Lain</button>
                                <button onPointerDown={(e) => {e.preventDefault(); setView('leaderboard');}} className="w-full bg-yellow-500 text-white font-bold py-3 rounded-xl hover:bg-yellow-600 transition">üèÜ Lihat Papan Skor</button>
                                <button onPointerDown={(e) => {e.preventDefault(); goHome();}} className="w-full bg-gray-800 text-white font-bold py-3 rounded-xl hover:bg-black transition">üè† Kembali ke Menu</button>
                            </div>
                        </div>
                    </div>
                );
            }

            const currentQ = sessionQuestions[questionIdx];
            if (!currentQ) return <div className="min-h-screen flex items-center justify-center">Loading...</div>;

            if (view === 'duel') {
                return (
                    <div className="h-screen w-screen flex overflow-hidden bg-gray-900" onPointerDown={(e) => e.stopPropagation()}>
                        <div className="w-1/2 h-full relative border-r-4 border-gray-700">
                            <GameBoard key={`p1-${duelRoundKey}`} isDuel={true} playerName={p1Name} playerIndex={1} questionData={currentQ} questionIndex={questionIdx} onCorrect={() => handleDuelWin(1)} onWrong={() => {}} score={p1Score} />
                        </div>
                        <div className="w-1/2 h-full relative">
                            <GameBoard key={`p2-${duelRoundKey}`} isDuel={true} playerName={p2Name} playerIndex={2} questionData={currentQ} questionIndex={questionIdx} onCorrect={() => handleDuelWin(2)} onWrong={() => {}} score={p2Score} />
                        </div>
                        <div className="absolute top-4 left-1/2 transform -translate-x-1/2 flex gap-2 z-50">
                            <button onPointerDown={(e) => {e.preventDefault(); goHome();}} className="bg-gray-800 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg border-2 border-white hover:bg-black" title="Menu Utama">üè†</button>
                            <button onPointerDown={(e) => {e.preventDefault(); goLevelSelect();}} className="bg-emerald-600 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg border-2 border-white hover:bg-emerald-700" title="Pilih Level">üìö</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-emerald-50 flex flex-col max-w-md mx-auto shadow-2xl overflow-hidden relative" onPointerDown={(e) => e.stopPropagation()}>
                    <div className="bg-white p-4 flex justify-between items-center shadow-sm z-10">
                        <div className="flex gap-2">
                            <button onPointerDown={(e) => {e.preventDefault(); goHome();}} className="text-gray-400 hover:text-emerald-600 font-bold px-2 py-1 rounded hover:bg-emerald-50 border border-transparent hover:border-emerald-200 transition" title="Menu Utama">üè†</button>
                            <button onPointerDown={(e) => {e.preventDefault(); goLevelSelect();}} className="text-gray-400 hover:text-emerald-600 font-bold px-2 py-1 rounded hover:bg-emerald-50 border border-transparent hover:border-emerald-200 transition" title="Pilih Level">üìö Level</button>
                        </div>
                        <div className="flex gap-1">{[1,2,3].map(i => <span key={i} className={i <= spLives ? "text-red-500" : "text-gray-200"}>‚ù§Ô∏è</span>)}</div>
                    </div>
                    <div className="w-full bg-gray-200 h-2">
                        <div className="bg-emerald-500 h-2 transition-all" style={{width: `${((questionIdx)/sessionQuestions.length)*100}%`}}></div>
                    </div>
                    <div className="flex-grow relative bg-white">
                        <GameBoard key={`sp-${questionIdx}`} playerName={p1Name} playerIndex={1} questionData={currentQ} questionIndex={questionIdx} onCorrect={handleSpCorrect} onWrong={handleSpWrong} score={spScore} />
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
